#!/usr/bin/env python3

"""Executable wrapper for setup-links.

This file intentionally bootstraps sys.path so it can import from `scripts_py`
even when called via a symlink or installed somewhere on $PATH.
"""

from __future__ import annotations

import sys
from pathlib import Path


def _find_repo_root(start: Path) -> Path:
    cur = start.resolve()
    while True:
        if (cur / "flake.nix").is_file() and (cur / "scripts_py").is_dir():
            return cur
        if cur.parent == cur:
            raise RuntimeError("Could not locate repo root (missing flake.nix/scripts_py).")
        cur = cur.parent


def main() -> int:
    script_path = Path(__file__).resolve()
    repo_root = _find_repo_root(script_path.parent)
    sys.path.insert(0, str(repo_root))

    from scripts_py.setup_links import main as impl_main

    return int(impl_main(sys.argv[1:]))


if __name__ == "__main__":
    raise SystemExit(main())