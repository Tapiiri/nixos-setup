# Managed by: nixos-setup (dotfiles/home/bashrc)
# Target: ~/.bashrc
#
# This file is a starting point. Add your aliases, env vars, and shell config here.
#
# If you use Home Manager for Bash configuration, consider moving most of this
# into your home-manager module instead.

# --- Home Manager integration -------------------------------------------------
#
# This repo symlinks this file to ~/.bashrc, while Home Manager may also manage
# Bash settings. To keep both worlds working together:
# - Load Home Manager session variables (PATH, locale, etc.)
# - Load Home Manager's generated bash init (which contains `bashrcExtra`, etc.)
#
# Both are optional and safe to source.
hm_profile_dir="${HOME_MANAGER_PROFILE_DIR:-$HOME/.nix-profile}"

# Prefer the hm-session-vars.sh from the Home Manager profile (itâ€™s guaranteed
# to match the active generation). Fallback to ~/.nix-profile for older setups.
if [ -f "$hm_profile_dir/etc/profile.d/hm-session-vars.sh" ]; then
	. "$hm_profile_dir/etc/profile.d/hm-session-vars.sh"
elif [ -f "$HOME/.nix-profile/etc/profile.d/hm-session-vars.sh" ]; then
	. "$HOME/.nix-profile/etc/profile.d/hm-session-vars.sh"
fi

# Final fallback: ensure ~/.local/bin is on PATH for interactive shells.
# (This keeps your repo-linked scripts discoverable even when the terminal
# environment doesn't propagate Home Manager session variables.)
case ":$PATH:" in
	*":$HOME/.local/bin:"*) : ;;
	*) export PATH="$HOME/.local/bin:$PATH" ;;
esac

if [ -f "$HOME/.nix-profile/etc/profile.d/hm-session-vars.sh" ]; then
	# Prefer the profile entrypoint when available.
	# It sets up $HOME_MANAGER_* variables and points to the actual generated init.
	:
fi

# Home Manager may generate a dedicated bash init file under ~/.nix-profile.
# The exact path can vary slightly across HM versions, so check common locations.
for hm_bashrc in \
	"$hm_profile_dir/etc/profile.d/hm-bashrc.sh" \
	"$hm_profile_dir/etc/profile.d/hm-bash.sh" \
	"$hm_profile_dir/etc/profile.d/hm-bashrc" \
	"$hm_profile_dir/share/bash/home-manager.sh" \
	"$hm_profile_dir/share/home-manager/bashrc" \
	"$HOME/.config/home-manager/current-home/etc/profile.d/hm-bashrc.sh"; do
	if [ -f "$hm_bashrc" ]; then
		. "$hm_bashrc"
		break
	fi
done

# --- End Home Manager integration --------------------------------------------

# Load VS Code shell integration when inside VS Code (matches the current system bashrc)
[[ "${TERM_PROGRAM-}" == "vscode" ]] && . "$(code --locate-shell-integration-path bash)"

# User customizations
# export EDITOR=nvim
# alias ll='ls -alF'
